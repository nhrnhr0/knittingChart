import{f as rt,a as tt,c as ke}from"../chunks/D9S_Li09.js";import{h as Ht,aV as Me,c as Et,aT as Te,u as Kt,k as Re,aW as Se,ai as Yt,aS as Z,w as Nt,ad as jt,x as R,am as m,ao as g,o as e,an as v,al as Ft,ak as yt,aX as Ct,aY as Le,Z as kt,aj as le,ag as Bt,aU as K}from"../chunks/8GO1uXHA.js";import{d as Wt,e as Mt,s as ut}from"../chunks/B0vZ6Z1w.js";import{i as Xt,s as Ie,a as he}from"../chunks/BXNESsZ2.js";import{r as gt,a as ft,s as De}from"../chunks/CbmEomM1.js";import{r as Pe,b as ae,p as Ae}from"../chunks/Dx2vTcTl.js";import{s as ze,g as ne}from"../chunks/Blda4rIg.js";import{e as xe,i as Ne,p as it}from"../chunks/DqiW7WKW.js";import{c as je,o as Xe}from"../chunks/Ds3ISDMl.js";import{i as Ye}from"../chunks/B53_6CW8.js";function Fe(r,t,n){var a=r==null?"":""+r;return t&&(a=a?a+" "+t:t),a===""?null:a}function We(r,t){return r==null?null:String(r)}function st(r,t,n,a,l,s){var f=r.__className;if(Ht||f!==n||f===void 0){var c=Fe(n,a);(!Ht||c!==r.getAttribute("class"))&&(c==null?r.removeAttribute("class"):r.className=c),r.__className=n}return s}function Be(r,t,n,a){var l=r.__style;if(Ht||l!==t){var s=We(t);(!Ht||s!==r.getAttribute("style"))&&(s==null?r.removeAttribute("style"):r.style.cssText=s),r.__style=t}return a}function Ge(r,t,n=t){var a=new WeakSet;Me(r,"input",async l=>{var s=l?r.defaultValue:r.value;if(s=oe(r)?ie(s):s,n(s),Et!==null&&a.add(Et),await Te(),s!==(s=t())){var f=r.selectionStart,c=r.selectionEnd,y=r.value.length;if(r.value=s??"",c!==null){var M=r.value.length;f===c&&c===y&&M>y?(r.selectionStart=M,r.selectionEnd=M):(r.selectionStart=f,r.selectionEnd=Math.min(c,M))}}}),(Ht&&r.defaultValue!==r.value||Kt(t)==null&&r.value)&&(n(oe(r)?ie(r.value):r.value),Et!==null&&a.add(Et)),Re(()=>{var l=t();if(r===document.activeElement){var s=Se??Et;if(a.has(s))return}oe(r)&&l===ie(r.value)||r.type==="date"&&!l&&!r.value||l!==r.value&&(r.value=l??"")})}function oe(r){var t=r.type;return t==="number"||t==="range"}function ie(r){return r===""?null:+r}const Ue=()=>{const r=ze;return{page:{subscribe:r.page.subscribe},navigating:{subscribe:r.navigating.subscribe},updated:r.updated}},Ee={subscribe(r){return Ue().page.subscribe(r)}};function Ke(r,t,n,a){const l=r-n,s=t-a;return Math.hypot(l,s)}function dt(r,t,n,a,l,s){const f=(1-r)*(1-t)*n.x+r*(1-t)*a.x+(1-r)*t*l.x+r*t*s.x,c=(1-r)*(1-t)*n.y+r*(1-t)*a.y+(1-r)*t*l.y+r*t*s.y;return{x:f,y:c}}function Vt(r,t,n){return{x:r.x+(t.x-r.x)*n,y:r.y+(t.y-r.y)*n}}function be(r,t,n){const a=l=>l.toString(16).padStart(2,"0");return`#${a(r)}${a(t)}${a(n)}`}function se(r){const t=r.match(/^#?([0-9a-fA-F]{6})$/);if(!t)return null;const n=parseInt(t[1],16);return{r:n>>16&255,g:n>>8&255,b:n&255}}function fe(r,t){const n=se(r),a=se(t);if(!n||!a)return Number.POSITIVE_INFINITY;const l=n.r-a.r,s=n.g-a.g,f=n.b-a.b;return Math.sqrt(l*l+s*s+f*f)}function He(r){const t=se(r);if(!t)return 0;const n=f=>{const c=f/255;return c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)},a=n(t.r),l=n(t.g),s=n(t.b);return .2126*a+.7152*l+.0722*s}function Qt(r){return He(r)>.179?"#000000":"#ffffff"}function Oe(r,t,n,a,l){const s=Math.max(1,Math.floor(l/2)),f=Math.min(Math.max(0,Math.round(n)-s),t.width-1),c=Math.min(Math.max(0,Math.round(a)-s),t.height-1),y=Math.min(l,t.width-f),M=Math.min(l,t.height-c),i=r.getImageData(f,c,y,M).data;let u=0,x=0,d=0,w=0;for(let _=0;_<i.length;_+=4)u+=i[_],x+=i[_+1],d+=i[_+2],w++;return w===0?null:{r:Math.round(u/w),g:Math.round(x/w),b:Math.round(d/w)}}function Ze(r){const t=document.createElement("canvas");t.width=r.naturalWidth||1,t.height=r.naturalHeight||1;const n=t.getContext("2d");return n?(n.clearRect(0,0,t.width,t.height),n.drawImage(r,0,0),{canvas:t,ctx:n}):null}function Ve(r,t,n,a,l,s,f){const c=Math.max(0,Math.floor(a)),y=Math.max(0,Math.floor(l));if(c<=0||y<=0||n.length!==4)return[];const M=n[0],i=n[1],u=n[3],x=n[2],d=[];for(let w=0;w<c;w++)for(let _=0;_<y;_++){const b=(_+.5)/y,T=(w+.5)/c,A=f(b,T,M,i,u,x),N=A.x*t.width,W=A.y*t.height,C=Oe(r,t,N,W,s);C&&d.push(be(C.r,C.g,C.b))}return d}function Qe(r){const{ctx:t,width:n,height:a,points:l,rows:s,cols:f,gridColor:c,gridThickness:y}=r;if(l.length!==4)return;const M=Math.max(0,Math.floor(s)),i=Math.max(0,Math.floor(f));if(!(M<=0||i<=0)){t.save(),t.lineWidth=Math.max(.5,y),t.strokeStyle=c,t.globalAlpha=.6;for(let u=1;u<M;u++){const x=u/M,d=Vt(l[0],l[3],x),w=Vt(l[1],l[2],x);t.beginPath(),t.moveTo(d.x*n,d.y*a),t.lineTo(w.x*n,w.y*a),t.stroke()}for(let u=1;u<i;u++){const x=u/i,d=Vt(l[0],l[1],x),w=Vt(l[3],l[2],x);t.beginPath(),t.moveTo(d.x*n,d.y*a),t.lineTo(w.x*n,w.y*a),t.stroke()}t.restore()}}function Je(r){const{ctx:t,width:n,height:a,points:l,rows:s,cols:f,colorLabels:c,imgCtx:y,imgCanvas:M,correctedLetters:i}=r;if(!c||c.length===0||l.length!==4)return;const u=Math.max(0,Math.floor(s)),x=Math.max(0,Math.floor(f));if(u<=0||x<=0)return;const d=n/x,w=a/u,_=Math.min(d,w),b=Math.max(4,Math.min(12,_*.24)),T=Math.max(8,Math.min(14,_*.28));t.font=`bold ${T}px Arial`,t.textAlign="center",t.textBaseline="middle";const A=l[0],N=l[1],W=l[3],C=l[2];for(let S=0;S<u;S++)for(let k=0;k<x;k++){const Y=S*x+k,I=(k+.5)/x,D=(S+.5)/u,j=dt(I,D,A,N,W,C),P=j.x*n,H=j.y*a;let V=null;if(i&&Y in i){const q=i[Y];V=c.find(Q=>Q.char===q)??null}else if(y&&M){const q=j.x*M.width,Q=j.y*M.height,J=qe(y,M,q,Q);J&&(V=$e(J,c))}V&&(t.fillStyle=V.hex,t.beginPath(),t.arc(P,H,b,0,Math.PI*2),t.fill(),t.fillStyle=V.textColor??"#ffffff",t.fillText(V.char,P,H))}}function qe(r,t,n,a){const s=Math.floor(1.5),f=Math.min(Math.max(0,Math.round(n)-s),t.width-1),c=Math.min(Math.max(0,Math.round(a)-s),t.height-1),y=Math.min(3,t.width-f),M=Math.min(3,t.height-c),i=r.getImageData(f,c,y,M).data;let u=0,x=0,d=0,w=0;for(let _=0;_<i.length;_+=4)u+=i[_],x+=i[_+1],d+=i[_+2],w++;return w===0?null:be(Math.round(u/w),Math.round(x/w),Math.round(d/w))}function $e(r,t){if(t.length===0)return null;let n=t[0],a=fe(r,n.hex);for(let l=1;l<t.length;l++){const s=fe(r,t[l].hex);s<a&&(a=s,n=t[l])}return n}function tr(r){const{ctx:t,width:n,height:a,points:l,gridColor:s,gridThickness:f,maxPoints:c}=r;t.lineWidth=f,t.strokeStyle=s,t.beginPath(),t.moveTo(l[0].x*n,l[0].y*a);for(let y=1;y<l.length;y++)t.lineTo(l[y].x*n,l[y].y*a);t.stroke(),l.length===c&&(t.beginPath(),t.moveTo(l[l.length-1].x*n,l[l.length-1].y*a),t.lineTo(l[0].x*n,l[0].y*a),t.stroke())}function er(r){const{ctx:t,width:n,height:a,points:l,gridColor:s,gridThickness:f}=r;t.fillStyle="#3b82f6";for(let c=0;c<l.length;c++){const y=l[c].x*n,M=l[c].y*a;t.beginPath(),t.arc(y,M,12,0,Math.PI*2),t.fill(),t.strokeStyle="#ffffff",t.lineWidth=3,t.stroke(),t.strokeStyle=s,t.lineWidth=f}}function rr(r){const{ctx:t,width:n,height:a,points:l,rows:s,cols:f,highlightRow:c,highlightCol:y,highlightColor:M="rgba(59, 130, 246, 0.3)",direction:i}=r;if(l.length!==4||c===void 0&&y===void 0)return;const u=Math.max(0,Math.floor(s)),x=Math.max(0,Math.floor(f));if(u<=0||x<=0)return;const d=l[0],w=l[1],_=l[3],b=l[2];if(t.save(),t.fillStyle=M,c!==void 0&&c>=0&&c<u){const T=c/u,A=(c+1)/u,N=dt(0,T,d,w,_,b),W=dt(1,T,d,w,_,b),C=dt(0,A,d,w,_,b),S=dt(1,A,d,w,_,b);if(t.beginPath(),t.moveTo(N.x*n,N.y*a),t.lineTo(W.x*n,W.y*a),t.lineTo(S.x*n,S.y*a),t.lineTo(C.x*n,C.y*a),t.closePath(),t.fill(),i){const k=(N.y+C.y)/2*a,Y=N.x*n,I=W.x*n,D=Math.min(20,(I-Y)*.1),j=10;if(t.fillStyle="rgba(59, 130, 246, 0.9)",t.strokeStyle="#ffffff",t.lineWidth=2,i==="LTR"){const P=Y+j;t.beginPath(),t.moveTo(P,k-D/2),t.lineTo(P+D,k),t.lineTo(P,k+D/2),t.closePath(),t.fill(),t.stroke()}else{const P=I-j;t.beginPath(),t.moveTo(P,k-D/2),t.lineTo(P-D,k),t.lineTo(P,k+D/2),t.closePath(),t.fill(),t.stroke()}}}if(y!==void 0&&y>=0&&y<x){t.fillStyle=M;const T=y/x,A=(y+1)/x,N=dt(T,0,d,w,_,b),W=dt(A,0,d,w,_,b),C=dt(T,1,d,w,_,b),S=dt(A,1,d,w,_,b);t.beginPath(),t.moveTo(N.x*n,N.y*a),t.lineTo(W.x*n,W.y*a),t.lineTo(S.x*n,S.y*a),t.lineTo(C.x*n,C.y*a),t.closePath(),t.fill()}t.restore()}var nr=rt('<button class="absolute bottom-2 left-2 bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs z-10" aria-label="Reset zoom" title="Hold Space + Drag to pan, Scroll to zoom">‚Ü∫ Reset</button>'),or=rt('<div class="relative w-full select-none"><canvas class="block w-full cursor-grab active:cursor-grabbing" style="touch-action: none;"></canvas> <!></div>');function ir(r,t){Yt(t,!0);const n=Pe(t,["$$slots","$$events","$$legacy"]);let{src:a,points:l,editable:s=!0,maxPoints:f=4,showOverlay:c=!0,rows:y=0,cols:M=0,gridColor:i="#22c55e",gridThickness:u=2}=n,x=Z(Nt(y??0)),d=Z(Nt(M??0)),w=Z(Nt(i??"#22c55e")),_=Z(Nt(u??2)),b=Z(void 0),T=Z(1),A=Z(0),N=Z(0);const W=.5,C=4;let S=0;const k=je();let Y,I,D=null,j=Z(0),P=Z(0),H=null,V=null,q=null,Q=null,J=Z(null),ht=Z(Nt(t.brushSize??1)),O=Z(!1),et=Nt(new Set),$=Z(!1),wt=Z(0),L=Z(0),F=Z(0),G=Z(0),U=Z(!1);function nt(o,p){const h=window.devicePixelRatio||1;I.width=Math.max(1,Math.floor(o*h)),I.height=Math.max(1,Math.floor(p*h)),I.style.width=`${o}px`,I.style.height=`${p}px`,D=I.getContext("2d"),D&&D.setTransform(h,0,0,h,0,0)}function vt(){if(!Y||!H)return;const p=Y.getBoundingClientRect().width,h=H.naturalHeight/H.naturalWidth||1,z=Math.max(1,Math.round(p*h));R(j,p,!0),R(P,z,!0),nt(e(j),e(P)),lt()}function Tt(o){const p=new Image;p.onload=()=>{H=p;const h=Ze(p);if(h&&(V=h.canvas,q=h.ctx),vt(),!(l&&l.length>0||e(b)&&e(b).length>0)){const X=[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:0,y:1}];R(b,X,!0),k("change",{points:X})}lt()},p.src=o}function Rt(o,p){const h=I.getBoundingClientRect(),z=(o-h.left)/h.width,X=(p-h.top)/h.height;return{x:Math.max(0,Math.min(1,z)),y:Math.max(0,Math.min(1,X))}}function Jt(o){if(!H||!q||!V||!e(b))return[];const p=Math.max(1,Math.floor(o.sampleSize??3));return Ve(q,V,e(b),o.rows??0,o.cols??0,p,dt)}function lt(){if(!D||!H)return;D.clearRect(0,0,e(j),e(P)),D.save(),D.translate(e(j)/2,e(P)/2),D.scale(e(T),e(T)),D.translate(e(A)*e(j)/e(T),e(N)*e(P)/e(T)),D.translate(-e(j)/2,-e(P)/2),D.drawImage(H,0,0,e(j),e(P));const o=e(b)??[];if(!c||o.length===0){D.restore();return}const p=Math.max(.5,e(_)||0),h={ctx:D,width:e(j),height:e(P),points:o,rows:e(x),cols:e(d),gridColor:e(w),gridThickness:p,colorLabels:t.colorLabels??[],maxPoints:f,imgCtx:q,imgCanvas:V,correctedLetters:t.correctedLetters};o.length===4&&(rr({ctx:D,width:e(j),height:e(P),points:o,rows:e(x),cols:e(d),highlightRow:t.highlightRow,highlightCol:t.highlightCol,direction:t.highlightDirection,highlightColor:t.highlightColor}),Qe(h),Je(h)),tr(h),er(h),t.correctionModeActive&&e(J)&&t.brushSize&&qt(D,e(J).x,e(J).y,t.brushSize),D.restore()}function qt(o,p,h,z){const X=z*e(j)/(2*e(d));o.strokeStyle="rgba(59, 130, 246, 0.7)",o.lineWidth=2,o.setLineDash([5,5]),o.beginPath(),o.arc(p,h,X,0,Math.PI*2),o.stroke(),o.setLineDash([]),o.strokeStyle="rgba(59, 130, 246, 0.5)",o.lineWidth=1,o.beginPath(),o.moveTo(p-8,h),o.lineTo(p+8,h),o.moveTo(p,h-8),o.lineTo(p,h+8),o.stroke()}function $t(o){o.stopPropagation();const p=Rt(o.clientX,o.clientY);if(t.correctionModeActive&&s&&e(x)>0&&e(d)>0&&e(b)&&e(b).length===4){const z=At(p,e(b));if(z){const X=t.brushSize??1,B=Pt(z.row,z.col,X,e(x),e(d));for(const E of B)k("cellClick",{row:0,col:0,cellIndex:E});return}}if(!s)return;const h=e(b)?[...e(b)]:[];h.length>=f||(h.push(p),R(b,h,!0),k("change",{points:h}),lt())}function ct(o){if(o.length<2)return 0;const p=o[0].clientX-o[1].clientX,h=o[0].clientY-o[1].clientY;return Math.sqrt(p*p+h*h)}function bt(o){const p=(o[0].clientX+o[1].clientX)/2,h=(o[0].clientY+o[1].clientY)/2;return{x:p,y:h}}function _t(o){o.touches.length===2&&!s&&(S=ct(o.touches))}function pt(o){if(o.touches.length===2&&S>0&&!s){o.preventDefault();const p=ct(o.touches),h=p/S,z=Math.max(W,Math.min(C,e(T)*h)),X=bt(o.touches),B=I.getBoundingClientRect(),E=(X.x-B.left)/B.width,ot=(X.y-B.top)/B.height;if(z!==e(T)){const at=z-e(T);R(A,e(A)-(E-.5)*at/e(T)),R(N,e(N)-(ot-.5)*at/e(T)),R(T,z,!0),lt()}S=p}}function St(o){o.touches.length<2&&(S=0)}function mt(o){if(!s&&Math.abs(o.deltaY)>0){o.preventDefault();const p=o.deltaY>0?.9:1.1,h=Math.max(W,Math.min(C,e(T)*p));if(h!==e(T)){const z=I.getBoundingClientRect(),X=(o.clientX-z.left)/z.width,B=(o.clientY-z.top)/z.height;R(A,e(A)-(X-.5)*(h-e(T))/e(T)),R(N,e(N)-(B-.5)*(h-e(T))/e(T)),R(T,h,!0),lt(),k("viewportChange",{zoom:e(T),panX:e(A),panY:e(N)})}}}function Lt(){R(T,1),R(A,0),R(N,0),lt(),k("viewportChange",{zoom:e(T),panX:e(A),panY:e(N)})}function It(o){o.code==="Space"&&(R(U,!0),o.preventDefault())}function Dt(o){o.code==="Space"&&R(U,!1)}function Pt(o,p,h,z,X){const B=[],E=Math.floor(h/2);for(let ot=Math.max(0,o-E);ot<=Math.min(z-1,o+E);ot++)for(let at=Math.max(0,p-E);at<=Math.min(X-1,p+E);at++)B.push(ot*X+at);return B}function At(o,p){const{x:h,y:z}=o;for(let X=0;X<e(x);X++)for(let B=0;B<e(d);B++){const E=te(X,B,p);if(Gt(o,E)){const ot=X*e(d)+B;return{row:X,col:B,cellIndex:ot}}}return null}function te(o,p,h){const z=o/e(x),X=p/e(d),B=(o+1)/e(x),E=(p+1)/e(d),ot=dt(X,z,h[0],h[1],h[3],h[2]),at=dt(E,z,h[0],h[1],h[3],h[2]),Zt=dt(X,B,h[0],h[1],h[3],h[2]),Ut=dt(E,B,h[0],h[1],h[3],h[2]);return[ot,at,Ut,Zt]}function Gt(o,p){const[h,z,X,B]=p,E=o,ot=zt=>zt>0?1:zt<0?-1:0,at=(zt,de,ge)=>(de.x-zt.x)*(ge.y-zt.y)-(de.y-zt.y)*(ge.x-zt.x),Zt=ot(at(h,z,E)),Ut=ot(at(z,X,E)),re=ot(at(X,B,E)),ue=ot(at(B,h,E));return Zt===Ut&&Ut===re&&re===ue||Zt===0||Ut===0||re===0||ue===0}function ee(o){if(!s)return;const p=e(b)??[],h=I.getBoundingClientRect(),z=(o.clientX-h.left)/h.width*e(j),X=(o.clientY-h.top)/h.height*e(P);if(t.correctionModeActive&&e(x)>0&&e(d)>0&&e(b)&&e(b).length===4){R(O,!0),et.clear(),ce(o.clientX,o.clientY),I.setPointerCapture(o.pointerId);return}if((e(U)||o.button===1)&&e(T)>W){R($,!0),R(wt,o.clientX,!0),R(L,o.clientY,!0),R(F,e(A),!0),R(G,e(N),!0),I.setPointerCapture(o.pointerId);return}const B=44;for(let E=0;E<p.length;E++){const ot=p[E].x*e(j),at=p[E].y*e(P);if(Ke(ot,at,z,X)<=B){Q=E,I.setPointerCapture(o.pointerId);break}}}function ye(o){const p=I.getBoundingClientRect();if(R(J,{x:o.clientX-p.left,y:o.clientY-p.top},!0),e(O)&&t.correctionModeActive){ce(o.clientX,o.clientY);return}if(e($)&&e(T)>W){const X=(o.clientX-e(wt))/p.width,B=(o.clientY-e(L))/p.height;R(A,e(F)+X),R(N,e(G)+B),lt();return}if(Q===null)return;const h=Rt(o.clientX,o.clientY),z=e(b)?[...e(b)]:[];z[Q]=h,R(b,z,!0),k("change",{points:z}),lt()}function we(o){I.releasePointerCapture(o.pointerId),R(O,!1),R($,!1),et.clear(),Q!==null&&(Q=null)}function ce(o,p){if(!(s&&e(x)>0&&e(d)>0&&e(b)&&e(b).length===4))return;const h=Rt(o,p),z=At(h,e(b));if(!z)return;const X=t.brushSize??1,B=Pt(z.row,z.col,X,e(x),e(d));for(const E of B)et.has(E)||(et.add(E),k("cellClick",{row:0,col:0,cellIndex:E}))}Xe(()=>{Tt(t.src);const o=new ResizeObserver(()=>vt());return o.observe(Y),window.addEventListener("keydown",It),window.addEventListener("keyup",Dt),()=>{o.disconnect(),window.removeEventListener("keydown",It),window.removeEventListener("keyup",Dt)}}),jt(()=>{Tt(t.src)}),jt(()=>{const o=l?[...l]:[];R(b,o.slice(0,f),!0),lt()}),jt(()=>{R(x,Number.isFinite(t.rows??0)?Number(t.rows??0):0,!0),R(d,Number.isFinite(t.cols??0)?Number(t.cols??0):0,!0),R(w,t.gridColor??"#22c55e",!0),R(_,Number.isFinite(t.gridThickness??0)?Number(t.gridThickness??0):2,!0),lt()}),jt(()=>{t.colorLabels,lt()}),jt(()=>{t.highlightRow,t.highlightCol,t.highlightDirection,t.highlightColor,lt()}),jt(()=>{R(ht,t.brushSize??1,!0),lt()});var pe={getCellColors:Jt},Ot=or(),xt=m(Ot);xt.__click=$t,xt.__pointerdown=ee,xt.__pointermove=ye,xt.__pointerup=we,xt.__touchstart=_t,xt.__touchmove=pt,xt.__touchend=St,ae(xt,o=>I=o,()=>I);var _e=g(xt,2);{var Ce=o=>{var p=nr();p.__click=Lt,tt(o,p)};Xt(_e,o=>{e(T)>W&&!s&&o(Ce)})}return v(Ot),ae(Ot,o=>Y=o,()=>Y),Mt("pointerleave",xt,()=>{R(J,null),Q=null,R(O,!1),et.clear()}),Mt("wheel",xt,mt),tt(r,Ot),Ft(pe)}Wt(["click","pointerdown","pointermove","pointerup","touchstart","touchmove","touchend"]);var lr=rt('<div class="flex items-center gap-2 bg-gray-100 rounded-lg p-1"><button>‚úèÔ∏è Edit</button> <button>üß∂ Work</button></div>');function ar(r,t){Yt(t,!0);var n=lr(),a=m(n);a.__click=()=>t.onToggle(!1);var l=g(a,2);l.__click=()=>t.onToggle(!0),v(n),yt(()=>{st(a,1,`px-4 py-2 rounded-md text-sm font-medium transition ${t.isWorking?"text-gray-600 hover:text-gray-900":"bg-white shadow text-gray-900"}`),st(l,1,`px-4 py-2 rounded-md text-sm font-medium transition ${t.isWorking?"bg-white shadow text-gray-900":"text-gray-600 hover:text-gray-900"}`)}),tt(r,n),Ft()}Wt(["click"]);var sr=rt('<div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6"><div><label for="rows" class="block text-sm font-medium text-gray-700 mb-2">Rows</label> <input id="rows" type="number" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/></div> <div><label for="cols" class="block text-sm font-medium text-gray-700 mb-2">Cols</label> <input id="cols" type="number" min="0" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/></div> <div><label for="grid-color" class="block text-sm font-medium text-gray-700 mb-2">Grid Color</label> <input id="grid-color" type="color" class="w-full h-10 px-2 py-1 border border-gray-300 rounded-lg cursor-pointer"/></div> <div><label for="grid-thickness" class="block text-sm font-medium text-gray-700 mb-2">Grid Thickness</label> <input id="grid-thickness" type="number" min="0.5" step="0.5" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/></div></div>');function cr(r,t){Yt(t,!0);function n(_){const b=Number(_.target.value)||0;t.onGridChange(b,t.cols,t.gridColor,t.gridThickness)}function a(_){const b=Number(_.target.value)||0;t.onGridChange(t.rows,b,t.gridColor,t.gridThickness)}function l(_){const b=_.target.value;t.onGridChange(t.rows,t.cols,b,t.gridThickness)}function s(_){const b=Number(_.target.value)||0;t.onGridChange(t.rows,t.cols,t.gridColor,b)}var f=sr(),c=m(f),y=g(m(c),2);gt(y),y.__change=n,v(c);var M=g(c,2),i=g(m(M),2);gt(i),i.__change=a,v(M);var u=g(M,2),x=g(m(u),2);gt(x),x.__change=l,v(u);var d=g(u,2),w=g(m(d),2);gt(w),w.__change=s,v(d),v(f),yt(()=>{ft(y,t.rows),ft(i,t.cols),ft(x,t.gridColor),ft(w,t.gridThickness)}),tt(r,f),Ft()}Wt(["change"]);var ur=rt('<p class="text-sm text-gray-600">No colors yet.</p>'),dr=rt('<div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 bg-gray-50 p-2 sm:p-3 rounded border border-gray-200 min-w-full sm:min-w-0"><div class="flex flex-col items-start sm:items-center gap-1 min-w-[80px]"><span class="text-xs font-semibold text-gray-600">Char</span> <input type="text" maxlength="2" class="w-12 h-8 text-center border border-gray-300 rounded font-semibold text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"/></div> <div class="flex flex-col items-start sm:items-center gap-1 min-w-[80px]"><span class="text-xs font-semibold text-gray-600">BG Color</span> <input type="color" class="w-12 h-10 border border-gray-300 rounded cursor-pointer" title="Background color"/></div> <div class="flex flex-col items-start sm:items-center gap-1 min-w-[80px]"><span class="text-xs font-semibold text-gray-600">Text Color</span> <input type="color" class="w-12 h-10 border border-gray-300 rounded cursor-pointer" title="Text color"/></div> <div class="flex flex-col gap-1 flex-1 min-w-[120px]"><span class="text-xs font-semibold text-gray-600">Hex</span> <input type="text" class="px-2 sm:px-3 py-2 border border-gray-300 rounded font-mono text-xs sm:text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="#000000"/></div> <button class="bg-red-600 hover:bg-red-700 text-white text-xs sm:text-sm font-semibold px-2 sm:px-3 py-2 rounded h-10 sm:self-end whitespace-nowrap">Delete</button></div>'),gr=rt('<div class="space-y-2 overflow-x-auto"></div>'),hr=rt('<div class="mb-6 mt-6"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2 gap-2 sm:gap-3"><p class="text-sm font-semibold text-gray-800">Colors</p> <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-3"><label class="text-xs text-gray-600 flex items-center gap-2 flex-wrap"><span>Threshold</span> <input type="number" min="0" max="441" step="1" class="w-16 sm:w-20 px-2 py-1 border border-gray-300 rounded text-sm"/></label> <button class="bg-emerald-600 hover:bg-emerald-700 text-white text-xs sm:text-sm font-semibold px-2 sm:px-3 py-2 rounded whitespace-nowrap">Auto-add colors</button></div></div> <div class="space-y-3"><div class="flex flex-col sm:flex-row gap-2 items-stretch sm:items-end"><div class="flex-1"><label for="new-color" class="block text-xs text-gray-600 mb-1">New color</label> <input id="new-color" type="color" class="w-full h-10 sm:h-10 px-2 py-1 border border-gray-300 rounded-lg cursor-pointer"/></div> <button class="bg-blue-600 hover:bg-blue-700 text-white text-xs sm:text-sm font-semibold px-3 sm:px-4 py-2 rounded whitespace-nowrap">Add</button></div> <!></div></div>');function fr(r,t){Yt(t,!0);let n=Z("#000000");function a(C){if(!C)return null;const S=C.trim().match(/^#?([0-9a-fA-F]{6})$/);return S?`#${S[1].toLowerCase()}`:null}function l(){const C=a(e(n));if(!C||t.colors.some(k=>k.hex.toLowerCase()===C.toLowerCase()))return;const S=String.fromCharCode(65+t.colors.length);t.onColorsChange([...t.colors,{hex:C,char:S,textColor:Qt(C)}])}function s(C){t.onColorsChange(t.colors.filter(S=>S.hex.toLowerCase()!==C.toLowerCase()))}function f(C,S){const k=[...t.colors];k[C]={...k[C],...S},t.onColorsChange(k)}var c=hr(),y=m(c),M=g(m(y),2),i=m(M),u=g(m(i),2);gt(u),u.__change=C=>t.onThresholdChange(Number(C.currentTarget.value)),v(i);var x=g(i,2);x.__click=function(...C){t.onAutoAdd?.apply(this,C)},v(M),v(y);var d=g(y,2),w=m(d),_=m(w),b=g(m(_),2);gt(b),v(_);var T=g(_,2);T.__click=l,v(w);var A=g(w,2);{var N=C=>{var S=ur();tt(C,S)},W=C=>{var S=gr();xe(S,21,()=>t.colors,Ne,(k,Y,I)=>{var D=dr(),j=m(D),P=g(m(j),2);gt(P),P.__change=et=>f(I,{char:et.currentTarget.value||"A"}),v(j);var H=g(j,2),V=g(m(H),2);gt(V),V.__change=et=>{const $=a(et.currentTarget.value);$&&f(I,{hex:$,textColor:Qt($)})},v(H);var q=g(H,2),Q=g(m(q),2);gt(Q),Q.__change=et=>{const $=a(et.currentTarget.value);$&&f(I,{textColor:$})},v(q);var J=g(q,2),ht=g(m(J),2);gt(ht),ht.__change=et=>{const $=a(et.currentTarget.value);$&&f(I,{hex:$,textColor:Qt($)})},v(J);var O=g(J,2);O.__click=()=>s(e(Y).hex),v(D),yt(()=>{ft(P,e(Y).char),ft(V,e(Y).hex),ft(Q,e(Y).textColor??"#ffffff"),ft(ht,e(Y).hex)}),tt(k,D)}),v(S),tt(C,S)};Xt(A,C=>{t.colors.length===0?C(N):C(W,!1)})}v(d),v(c),yt(()=>ft(u,t.colorThreshold)),Ge(b,()=>e(n),C=>R(n,C)),tt(r,c),Ft()}Wt(["change","click"]);var vr=rt('<div class="border-t pt-6 mb-6"><h3 class="text-sm font-semibold text-gray-800 mb-4">Working Settings</h3> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><span class="block text-sm font-medium text-gray-700 mb-2">Start From</span> <div class="flex gap-2"><button>‚Üë Bottom</button> <button>‚Üì Top</button></div></div> <div><span class="block text-sm font-medium text-gray-700 mb-2">First Row Stitch</span> <div class="flex gap-2"><button>K (Knit)</button> <button>P (Perl)</button></div></div> <div><span class="block text-sm font-medium text-gray-700 mb-2">Knit Row Direction</span> <div class="flex gap-2"><button>‚Üê RTL</button> <button>‚Üí LTR</button></div></div> <div><span class="block text-sm font-medium text-gray-700 mb-2">Perl Row Direction</span> <div class="flex gap-2"><button>‚Üê RTL</button> <button>‚Üí LTR</button></div></div> <div><span class="block text-sm font-medium text-gray-700 mb-2">Highlight Color</span> <input type="color" class="w-full h-10 px-2 py-1 border border-gray-300 rounded-lg cursor-pointer"/></div> <div><span class="block text-sm font-medium text-gray-700 mb-2">Starting Column (0-indexed)</span> <input type="number" min="0" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"/></div></div></div>');function mr(r,t){Yt(t,!0);var n=vr(),a=g(m(n),2),l=m(a),s=g(m(l),2),f=m(s);f.__click=()=>t.onUpdate({startFromBottom:!0});var c=g(f,2);c.__click=()=>t.onUpdate({startFromBottom:!1}),v(s),v(l);var y=g(l,2),M=g(m(y),2),i=m(M);i.__click=()=>t.onUpdate({startStitch:"K"});var u=g(i,2);u.__click=()=>t.onUpdate({startStitch:"P"}),v(M),v(y);var x=g(y,2),d=g(m(x),2),w=m(d);w.__click=()=>t.onUpdate({knitDirection:"RTL"});var _=g(w,2);_.__click=()=>t.onUpdate({knitDirection:"LTR"}),v(d),v(x);var b=g(x,2),T=g(m(b),2),A=m(T);A.__click=()=>t.onUpdate({perlDirection:"RTL"});var N=g(A,2);N.__click=()=>t.onUpdate({perlDirection:"LTR"}),v(T),v(b);var W=g(b,2),C=g(m(W),2);gt(C),C.__change=Y=>{const I=Y.currentTarget.value,D=t.workingState.highlightColor.match(/[\d.]+\)$/)?.[0].slice(0,-1)||"0.4",j=parseInt(I.slice(1,3),16),P=parseInt(I.slice(3,5),16),H=parseInt(I.slice(5,7),16);t.onUpdate({highlightColor:`rgba(${j}, ${P}, ${H}, ${D})`})},v(W);var S=g(W,2),k=g(m(S),2);gt(k),k.__change=Y=>t.onUpdate({startCol:Math.max(0,parseInt(Y.currentTarget.value,10))}),v(S),v(a),v(n),yt(Y=>{st(f,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.startFromBottom?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(c,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.startFromBottom?"bg-gray-100 text-gray-700 hover:bg-gray-200":"bg-blue-600 text-white"}`),st(i,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.startStitch==="K"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(u,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.startStitch==="P"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(w,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.knitDirection==="RTL"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(_,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.knitDirection==="LTR"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(A,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.perlDirection==="RTL"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),st(N,1,`flex-1 px-3 py-2 rounded-lg text-sm font-medium transition ${t.workingState.perlDirection==="LTR"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`),ft(C,Y),ft(k,t.workingState.startCol??0)},[()=>t.workingState.highlightColor.slice(0,7)]),tt(r,n),Ft()}Wt(["click","change"]);var xr=rt('<div class="bg-white rounded-lg shadow p-3 sm:p-6 mt-6"><h2 class="text-base sm:text-lg font-semibold text-gray-800 mb-3 sm:mb-4 text-center"> </h2> <div class="space-y-3 sm:space-y-6"><div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6 flex-wrap"><div class="flex items-center gap-2 sm:gap-3"><button class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed font-bold text-xl sm:text-2xl">‚àí</button> <div class="text-center min-w-[90px] sm:min-w-[100px]"><div class="text-lg sm:text-3xl font-bold text-gray-800"> </div> <div class="text-xs sm:text-sm text-gray-500"> </div></div> <button class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-gray-200 hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed font-bold text-xl sm:text-2xl">+</button></div> <div class="flex items-center gap-2 sm:gap-3"><button class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-200 hover:bg-blue-300 disabled:opacity-50 disabled:cursor-not-allowed font-bold text-xl sm:text-2xl">‚àí</button> <div class="text-center min-w-[90px] sm:min-w-[100px]"><div class="text-lg sm:text-3xl font-bold text-blue-600"> </div> <div class="text-xs sm:text-sm text-gray-500"> </div></div> <button class="w-10 h-10 sm:w-12 sm:h-12 rounded-full bg-blue-200 hover:bg-blue-300 disabled:opacity-50 disabled:cursor-not-allowed font-bold text-xl sm:text-2xl">+</button></div> <div> <span class="ml-1 sm:ml-2 text-lg sm:text-3xl"> </span></div></div> <div class="bg-gray-50 rounded-xl p-3 sm:p-6 overflow-x-auto"><div class="text-xs sm:text-sm font-medium text-gray-600 mb-2">Row Pattern</div> <div class="text-lg sm:text-2xl font-mono font-bold text-gray-800 whitespace-nowrap"> </div> <div class="text-xs sm:text-sm text-gray-500 mt-2 whitespace-normal"> </div></div> <div class="flex flex-col sm:flex-row justify-center gap-2 sm:gap-4"><button class="text-xs sm:text-sm text-blue-600 hover:text-blue-800 font-medium px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-50">‚Üê Go to Row 1</button> <button class="text-xs sm:text-sm text-blue-600 hover:text-blue-800 font-medium px-3 sm:px-4 py-2 rounded-lg hover:bg-blue-50">Go to Last Row ‚Üí</button></div></div></div>');function br(r,t){var n=xr(),a=m(n),l=m(a);v(a);var s=g(a,2),f=m(s),c=m(f),y=m(c);y.__click=function(...O){t.onDecrementRow?.apply(this,O)};var M=g(y,2),i=m(M),u=m(i);v(i);var x=g(i,2),d=m(x);v(x),v(M);var w=g(M,2);w.__click=function(...O){t.onIncrementRow?.apply(this,O)},v(c);var _=g(c,2),b=m(_);b.__click=function(...O){t.onDecrementCol?.apply(this,O)};var T=g(b,2),A=m(T),N=m(A);v(A);var W=g(A,2),C=m(W);v(W),v(T);var S=g(T,2);S.__click=function(...O){t.onIncrementCol?.apply(this,O)},v(_);var k=g(_,2),Y=m(k),I=g(Y),D=m(I,!0);v(I),v(k),v(f);var j=g(f,2),P=g(m(j),2),H=m(P,!0);v(P);var V=g(P,2),q=m(V,!0);v(V),v(j);var Q=g(j,2),J=m(Q);J.__click=function(...O){t.onGoToFirst?.apply(this,O)};var ht=g(J,2);ht.__click=function(...O){t.onGoToLast?.apply(this,O)},v(Q),v(s),v(n),yt(()=>{ut(l,`Working on Row ${t.displayRowNumber??""} of ${t.totalRows??""}`),y.disabled=t.displayRowNumber<=1,ut(u,`Row ${t.displayRowNumber??""}`),ut(d,`of ${t.totalRows??""}`),w.disabled=t.displayRowNumber>=t.totalRows,b.disabled=t.currentDirection==="LTR"?t.currentCol<=1:t.currentCol>t.cols,ut(N,`Col ${t.currentCol+t.startCol}`),ut(C,`of ${t.cols??""}`),S.disabled=t.currentDirection==="LTR"?t.currentCol>=t.cols:t.currentCol<1,st(k,1,`px-3 sm:px-6 py-2 sm:py-3 rounded-xl font-bold text-sm sm:text-2xl whitespace-nowrap ${t.currentStitchType==="K"?"bg-purple-100 text-purple-800":"bg-orange-100 text-orange-800"}`),ut(Y,`${t.currentStitchType==="K"?"Knit":"Perl"} `),ut(D,t.currentDirection==="LTR"?"‚Üí":"‚Üê"),ut(H,t.currentRowRLE||"Loading..."),ut(q,t.currentDirection==="LTR"?"Reading left ‚Üí right":"Reading right ‚Üê left")}),tt(r,n)}Wt(["click"]);var yr=rt("<button> </button>"),wr=rt('<div class="space-y-2"><div class="flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3"><label for="brush-size" class="text-sm font-semibold text-gray-700 whitespace-nowrap">Brush Size:</label> <div class="flex flex-1 items-center gap-2"><input id="brush-size" type="range" min="1" max="5" class="flex-1 min-w-0"/> <span class="text-sm font-bold bg-blue-100 px-2 sm:px-3 py-1 rounded whitespace-nowrap"> </span></div></div></div> <div class="space-y-2"><div class="text-sm font-semibold text-gray-700">Select Letter to Paint:</div> <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2 overflow-x-auto"></div></div> <p class="text-xs sm:text-sm text-gray-600 bg-blue-50 p-2 rounded">üí° Click on cells to paint with <strong> </strong> </p> <div class="flex gap-2 flex-wrap"><button>‚Ü∂ Undo</button> <button>‚Ü∑ Redo</button> <button class="px-2 sm:px-3 py-2 rounded text-xs sm:text-sm font-medium bg-red-500 text-white hover:bg-red-600 transition">üóëÔ∏è Clear All</button></div>',1),pr=rt('<div class="correction-panel border rounded-lg p-3 sm:p-4 bg-slate-50 space-y-3 svelte-y7h971"><div class="flex items-center gap-2"><button> </button></div> <!></div>');function _r(r,t){Yt(t,!1);const n=kt(),a=kt(),l=kt(),s=kt(),f=kt(),c=kt(),y=kt(),M=kt();let i=Ae(t,"project",8);function u(){it.toggleCorrectionMode(i().uuid)}function x(k){it.setCorrectionLetter(i().uuid,k)}function d(k){it.setBrushSize(i().uuid,k)}function w(){it.undoCorrection(i().uuid)}function _(){it.redoCorrection(i().uuid)}function b(){confirm("Clear all cell corrections?")&&it.clearCorrections(i().uuid)}Ct(()=>Bt(i()),()=>{R(n,i().colors||[])}),Ct(()=>Bt(i()),()=>{R(a,i().correctionModeActive||!1)}),Ct(()=>(Bt(i()),e(n)),()=>{R(l,i().selectedLetter||(e(n)[0]?.char??""))}),Ct(()=>Bt(i()),()=>{R(s,i().brushSize??1)}),Ct(()=>Bt(i()),()=>{R(f,i().__undoStack||[])}),Ct(()=>Bt(i()),()=>{R(c,i().__redoStack||[])}),Ct(()=>e(f),()=>{R(y,e(f).length>0)}),Ct(()=>e(c),()=>{R(M,e(c).length>0)}),Le(),Ye();var T=pr(),A=m(T),N=m(A),W=m(N,!0);v(N),v(A);var C=g(A,2);{var S=k=>{var Y=wr(),I=le(Y),D=m(I),j=g(m(D),2),P=m(j);gt(P);var H=g(P,2),V=m(H);v(H),v(j),v(D),v(I);var q=g(I,2),Q=g(m(q),2);xe(Q,5,()=>e(n),G=>G.char,(G,U)=>{var nt=yr(),vt=m(nt,!0);v(nt),yt(()=>{st(nt,1,(e(l),e(U),Kt(()=>`px-2 sm:px-3 py-2 rounded text-xs sm:text-sm font-bold transition border-2 min-h-10 ${e(l)===e(U).char?"border-blue-500 bg-white scale-105":"border-transparent hover:border-gray-300"}`)),"svelte-y7h971"),Be(nt,(e(U),Kt(()=>`background-color: ${e(U).hex}; color: ${e(U).textColor||"black"};`))),De(nt,"title",(e(U),Kt(()=>`Select letter ${e(U).char}`))),ut(vt,(e(U),Kt(()=>e(U).char)))}),Mt("click",nt,()=>x(e(U).char)),tt(G,nt)}),v(Q),v(q);var J=g(q,2),ht=g(m(J)),O=m(ht,!0);v(ht);var et=g(ht);v(J);var $=g(J,2),wt=m($),L=g(wt,2),F=g(L,2);v($),yt(()=>{ft(P,e(s)),ut(V,`${e(s)??""}√ó${e(s)??""}`),ut(O,e(l)),ut(et,` (brush: ${e(s)??""}√ó${e(s)??""})`),wt.disabled=!e(y),st(wt,1,`px-2 sm:px-3 py-2 rounded text-xs sm:text-sm font-medium transition ${e(y)?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,"svelte-y7h971"),L.disabled=!e(M),st(L,1,`px-2 sm:px-3 py-2 rounded text-xs sm:text-sm font-medium transition ${e(M)?"bg-orange-500 text-white hover:bg-orange-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,"svelte-y7h971")}),Mt("change",P,G=>d(parseInt(G.currentTarget.value))),Mt("click",wt,w),Mt("click",L,_),Mt("click",F,b),tt(k,Y)};Xt(C,k=>{e(a)&&k(S)})}v(T),yt(()=>{st(N,1,`px-3 sm:px-4 py-2 rounded font-medium text-sm sm:text-base transition ${e(a)?"bg-blue-500 text-white":"bg-gray-300 text-gray-700 hover:bg-gray-400"}`,"svelte-y7h971"),ut(W,e(a)?"‚úèÔ∏è Correction Mode ON":"Correction Mode OFF")}),Mt("click",N,u),tt(r,T),Ft()}function Cr(r,t){const n=r%2===0;return t==="K"?n?"K":"P":n?"P":"K"}function kr(r,t,n){return r==="K"?t:n}function Mr(r,t,n){return t?n-1-r:r}function Tr(r){return r+1}function Rr(r,t,n,a,l,s){if(n<=0||a.length===0)return"";const f=t*n;if(f>=r.length)return"";let c=Array.from({length:Math.min(n,r.length-f)},(d,w)=>f+w),y=c.map(d=>r[d]);l==="RTL"&&(c=[...c].reverse(),y=[...y].reverse());const M=c.map((d,w)=>s&&d in s?s[d]:Sr(y[w],a)?.char??"?"),i=[];let u=M[0],x=1;for(let d=1;d<M.length;d++)M[d]===u?x++:(i.push({char:u,count:x}),u=M[d],x=1);return i.push({char:u,count:x}),i.map(d=>`${d.count}${d.char}`).join(" ")}function Sr(r,t){if(t.length===0)return null;const n=c=>c.toLowerCase().replace("#",""),a=n(r),l=t.find(c=>n(c.hex)===a);if(l)return l;let s=t[0],f=ve(r,s.hex);for(let c=1;c<t.length;c++){const y=ve(r,t[c].hex);y<f&&(f=y,s=t[c])}return s}function ve(r,t){const n=me(r),a=me(t);if(!n||!a)return Number.POSITIVE_INFINITY;const l=n.r-a.r,s=n.g-a.g,f=n.b-a.b;return Math.sqrt(l*l+s*s+f*f)}function me(r){const t=r.match(/^#?([0-9a-fA-F]{6})$/);if(!t)return null;const n=parseInt(t[1],16);return{r:n>>16&255,g:n>>8&255,b:n&255}}function Lr(){return{isActive:!1,currentRow:0,currentCol:0,startFromBottom:!0,startStitch:"K",knitDirection:"RTL",perlDirection:"LTR",highlightColor:"rgba(34, 197, 94, 0.4)",startCol:0}}var Ir=rt('<!> <div class="mb-6"><label for="project-image" class="block text-sm font-medium text-gray-700 mb-2">Image</label> <input id="project-image" type="file" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-50 file:text-blue-700"/></div> <div class="mb-6"><label for="project-name" class="block text-sm font-medium text-gray-700 mb-2">Name</label> <input id="project-name" type="text" class="w-full px-4 py-2 border border-gray-300 rounded-lg"/></div> <!> <!> <!> <div class="border-t pt-6"><button class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg">Delete</button></div>',1),Dr=rt('<div class="container mx-auto px-6 max-w-2xl"><!></div>'),Pr=rt('<div class="container mx-auto p-6 max-w-2xl"><div class="mb-6 flex items-center justify-between"><button class="text-blue-600 hover:text-blue-800 font-semibold">‚Üê Back</button> <!></div> <div class="bg-white rounded-lg shadow p-8"><!> <!></div> <!></div>'),Ar=rt('<div class="container mx-auto p-6 text-center"><p class="text-gray-500 text-lg mb-4">Project not found</p> <button class="text-blue-600 hover:text-blue-800 font-semibold">Back</button></div>');function Er(r,t){Yt(t,!0);const n=()=>he(Ee,"$page",l),a=()=>he(it,"$projects",l),[l,s]=Ie();let f=Z(null),c=Z(Nt([])),y=Z(75),M=K(()=>n().params.uuid),i=K(()=>a().find(L=>L.uuid===e(M))),u=K(()=>e(i)?.workingState??Lr()),x=K(()=>e(i)?.rows??0),d=K(()=>e(i)?.cols??0),w=K(()=>e(i)?.colors??[]),_=K(()=>Cr(e(u).currentRow,e(u).startStitch)),b=K(()=>kr(e(_),e(u).knitDirection,e(u).perlDirection)),T=K(()=>Mr(e(u).currentRow,e(u).startFromBottom,e(x))),A=K(()=>Tr(e(u).currentRow)),N=K(()=>Rr(e(c),e(T),e(d),e(w),e(b),e(i)?.correctedLetters)),W=K(()=>e(b)==="RTL"?e(d)-1-e(u).currentCol:e(u).currentCol),C=K(()=>e(A)%2===1);async function S(){if(!e(f)||e(x)<=0||e(d)<=0){R(c,[],!0);return}try{R(c,await e(f).getCellColors({rows:e(x),cols:e(d),sampleSize:3}),!0)}catch{R(c,[],!0)}}function k(L){e(i)&&it.updateProjectWorkingState(e(i).uuid,L)}function Y(L){k({isActive:L}),L&&S()}jt(()=>{e(u).isActive&&e(f)&&S()});function I(L,F,G,U){e(i)&&it.updateProjectGrid(e(i).uuid,L,F,G,U)}function D(L){e(i)&&it.updateProjectColors(e(i).uuid,L)}async function j(){if(!e(i)?.image||!e(f)||!e(i).cropPoints?.length||e(x)<=0||e(d)<=0)return;const F=(await e(f).getCellColors({rows:e(x),cols:e(d),sampleSize:3})).map((G,U)=>({hex:G,char:String.fromCharCode(65+e(w).length+U),textColor:Qt(G)}));D(P([...e(w),...F],e(y)))}function P(L,F){const G=[];for(const U of L){const nt=U.hex.toLowerCase();G.every(vt=>H(vt.hex,nt)>F)&&G.push({...U,hex:nt})}return G}function H(L,F){const G=parseInt(L.slice(1,3),16),U=parseInt(L.slice(3,5),16),nt=parseInt(L.slice(5,7),16),vt=parseInt(F.slice(1,3),16),Tt=parseInt(F.slice(3,5),16),Rt=parseInt(F.slice(5,7),16);return Math.sqrt((G-vt)**2+(U-Tt)**2+(nt-Rt)**2)}function V(L){e(i)&&it.updateProjectCrop(e(i).uuid,L.detail.points)}function q(L){if(!e(i)?.correctionModeActive||!e(i)?.selectedLetter)return;const{cellIndex:F}=L.detail;it.paintCell(e(i).uuid,F,e(i).selectedLetter)}function Q(L){if(!e(i))return;const F=L.target.files?.[0];if(!F)return;const G=new FileReader;G.onload=U=>{it.updateProjectImage(e(i).uuid,U.target?.result),it.updateProjectCrop(e(i).uuid,void 0)},G.readAsDataURL(F)}function J(L){const F=L.target.value.trim();e(i)&&F&&it.updateProject(e(i).uuid,F)}function ht(){e(i)&&confirm(`Delete "${e(i).name}"?`)&&(it.deleteProject(e(i).uuid),ne("/"))}var O=ke(),et=le(O);{var $=L=>{var F=Pr(),G=m(F),U=m(G);U.__click=()=>ne("/");var nt=g(U,2);ar(nt,{get isWorking(){return e(u).isActive},onToggle:Y}),v(G);var vt=g(G,2),Tt=m(vt);{var Rt=ct=>{{let bt=K(()=>e(i).gridColor??"#22c55e"),_t=K(()=>e(i).gridThickness??2),pt=K(()=>e(u).isActive&&!e(i)?.correctionModeActive?e(T):void 0),St=K(()=>e(u).isActive&&!e(i)?.correctionModeActive?e(W):void 0),mt=K(()=>e(u).isActive&&!e(i)?.correctionModeActive?e(b):void 0),Lt=K(()=>e(i)?.correctedLetters),It=K(()=>e(i)?.brushSize),Dt=K(()=>e(i)?.correctionModeActive),Pt=K(()=>!e(u).isActive||e(i)?.correctionModeActive);ae(ir(ct,{get src(){return e(i).image},get points(){return e(i).cropPoints},get rows(){return e(x)},get cols(){return e(d)},get gridColor(){return e(bt)},get gridThickness(){return e(_t)},get colorLabels(){return e(w)},get highlightRow(){return e(pt)},get highlightCol(){return e(St)},get highlightDirection(){return e(mt)},get highlightColor(){return e(u).highlightColor},get correctedLetters(){return e(Lt)},get brushSize(){return e(It)},get correctionModeActive(){return e(Dt)},get editable(){return e(Pt)},$$events:{change:V,cellClick:q}}),At=>R(f,At,!0),()=>e(f))}};Xt(Tt,ct=>{e(i).image&&ct(Rt)})}var Jt=g(Tt,2);{var lt=ct=>{var bt=Ir(),_t=le(bt);_r(_t,{get project(){return e(i)}});var pt=g(_t,2),St=g(m(pt),2);St.__change=Q,v(pt);var mt=g(pt,2),Lt=g(m(mt),2);gt(Lt),Lt.__change=J,v(mt);var It=g(mt,2);{let Gt=K(()=>e(i).gridColor??"#22c55e"),ee=K(()=>e(i).gridThickness??2);cr(It,{get rows(){return e(x)},get cols(){return e(d)},get gridColor(){return e(Gt)},get gridThickness(){return e(ee)},onGridChange:I})}var Dt=g(It,2);fr(Dt,{get colors(){return e(w)},get colorThreshold(){return e(y)},onColorsChange:D,onAutoAdd:j,onThresholdChange:Gt=>R(y,Gt,!0)});var Pt=g(Dt,2);mr(Pt,{get workingState(){return e(u)},onUpdate:k});var At=g(Pt,2),te=m(At);te.__click=ht,v(At),yt(()=>ft(Lt,e(i).name)),tt(ct,bt)};Xt(Jt,ct=>{e(u).isActive||ct(lt)})}v(vt);var qt=g(vt,2);{var $t=ct=>{var bt=Dr(),_t=m(bt);{let pt=K(()=>e(u).currentCol+1);br(_t,{get displayRowNumber(){return e(A)},get totalRows(){return e(x)},get currentCol(){return e(pt)},get cols(){return e(d)},get startCol(){return e(u).startCol},get currentStitchType(){return e(_)},get currentDirection(){return e(b)},get currentRowRLE(){return e(N)},onIncrementRow:()=>e(u).currentRow<e(x)-1&&k({currentRow:e(u).currentRow+1,currentCol:0}),onDecrementRow:()=>e(u).currentRow>0&&k({currentRow:e(u).currentRow-1,currentCol:0}),onIncrementCol:()=>{const mt=e(C)?e(b)==="LTR"?Math.max(e(u).currentCol-1,0):Math.min(e(u).currentCol+1,e(d)-1):e(b)==="LTR"?Math.min(e(u).currentCol+1,e(d)-1):Math.max(e(u).currentCol-1,0);k({currentCol:mt})},onDecrementCol:()=>{const mt=e(C)?e(b)==="LTR"?Math.min(e(u).currentCol+1,e(d)-1):Math.max(e(u).currentCol-1,0):e(b)==="LTR"?Math.max(e(u).currentCol-1,0):Math.min(e(u).currentCol+1,e(d)-1);k({currentCol:mt})},onGoToFirst:()=>k({currentRow:0,currentCol:0}),onGoToLast:()=>k({currentRow:e(x)-1,currentCol:0})})}v(bt),tt(ct,bt)};Xt(qt,ct=>{e(u).isActive&&ct($t)})}v(F),tt(L,F)},wt=L=>{var F=Ar(),G=g(m(F),2);G.__click=()=>ne("/"),v(F),tt(L,F)};Xt(et,L=>{e(i)?L($):L(wt,!1)})}tt(r,O),Ft(),s()}Wt(["click","change"]);export{Er as component};
