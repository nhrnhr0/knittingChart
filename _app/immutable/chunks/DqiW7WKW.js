import{H as x,h as N,I as W,e as O,J as Q,K as Z,o as j,v as $,M as ee,O as re,Q as Y,R as D,i as b,T as te,U as ne,V,c as ae,f as H,s as oe,W as F,X as ie,Y as q,Z as ue,_ as fe,$ as se,a0 as ce,a1 as m,r as K,p as X,a2 as P,a3 as le,a4 as de,d as ve,q as _e,a5 as y,a6 as ge}from"./8GO1uXHA.js";import{w as he}from"./Ds3ISDMl.js";function we(o,s){return s}function Se(o,s,d){for(var f=[],a=s.length,t,e=s.length,r=0;r<a;r++){let S=s[r];X(S,()=>{if(t){if(t.pending.delete(S),t.done.add(S),t.pending.size===0){var v=o.outrogroups;z(F(t.done)),v.delete(t),v.size===0&&(o.outrogroups=null)}}else e-=1},!1)}if(e===0){var i=f.length===0&&d!==null;if(i){var c=d,u=c.parentNode;de(u),u.append(c),o.items.clear()}z(s,!i)}else t={pending:new Set(s),done:new Set},(o.outrogroups??=new Set).add(t)}function z(o,s=!0){for(var d=0;d<o.length;d++)ve(o[d],s)}var B;function Te(o,s,d,f,a,t=null){var e=o,r=new Map,i=(s&y)!==0;if(i){var c=o;e=N?x(W(c)):c.appendChild(O())}N&&Q();var u=null,S=$(()=>{var l=d();return ie(l)?l:l==null?[]:F(l)}),v,g=!0;function E(){n.fallback=u,pe(n,v,e,s,f),u!==null&&(v.length===0?(u.f&m)===0?K(u):(u.f^=m,R(u,null,e)):X(u,()=>{u=null}))}var T=Z(()=>{v=j(S);var l=v.length;let L=!1;if(N){var A=ee(e)===re;A!==(l===0)&&(e=Y(),x(e),D(!1),L=!0)}for(var p=new Set,C=ae,I=oe(),h=0;h<l;h+=1){N&&b.nodeType===te&&b.data===ne&&(e=b,L=!0,D(!1));var w=v[h],M=f(w,h),_=g?null:r.get(M);_?(_.v&&V(_.v,w),_.i&&V(_.i,h),I&&C.skipped_effects.delete(_.e)):(_=me(r,g?e:B??=O(),w,M,h,a,s,d),g||(_.e.f|=m),r.set(M,_)),p.add(M)}if(l===0&&t&&!u&&(g?u=H(()=>t(e)):(u=H(()=>t(B??=O())),u.f|=m)),N&&l>0&&x(Y()),!g)if(I){for(const[G,U]of r)p.has(G)||C.skipped_effects.add(U.e);C.oncommit(E),C.ondiscard(()=>{})}else E();L&&D(!0),j(S)}),n={effect:T,items:r,outrogroups:null,fallback:u};g=!1,N&&(e=b)}function pe(o,s,d,f,a){var t=(f&ge)!==0,e=s.length,r=o.items,i=o.effect.first,c,u=null,S,v=[],g=[],E,T,n,l;if(t)for(l=0;l<e;l+=1)E=s[l],T=a(E,l),n=r.get(T).e,(n.f&m)===0&&(n.nodes?.a?.measure(),(S??=new Set).add(n));for(l=0;l<e;l+=1){if(E=s[l],T=a(E,l),n=r.get(T).e,o.outrogroups!==null)for(const _ of o.outrogroups)_.pending.delete(n),_.done.delete(n);if((n.f&m)!==0)if(n.f^=m,n===i)R(n,null,d);else{var L=u?u.next:i;n===o.effect.last&&(o.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),k(o,u,n),k(o,n,L),R(n,L,d),u=n,v=[],g=[],i=u.next;continue}if((n.f&P)!==0&&(K(n),t&&(n.nodes?.a?.unfix(),(S??=new Set).delete(n))),n!==i){if(c!==void 0&&c.has(n)){if(v.length<g.length){var A=g[0],p;u=A.prev;var C=v[0],I=v[v.length-1];for(p=0;p<v.length;p+=1)R(v[p],A,d);for(p=0;p<g.length;p+=1)c.delete(g[p]);k(o,C.prev,I.next),k(o,u,C),k(o,I,A),i=A,u=I,l-=1,v=[],g=[]}else c.delete(n),R(n,i,d),k(o,n.prev,n.next),k(o,n,u===null?o.effect.first:u.next),k(o,u,n),u=n;continue}for(v=[],g=[];i!==null&&i!==n;)(c??=new Set).add(i),g.push(i),i=i.next;if(i===null)continue}(n.f&m)===0&&v.push(n),u=n,i=n.next}if(o.outrogroups!==null){for(const _ of o.outrogroups)_.pending.size===0&&(z(F(_.done)),o.outrogroups?.delete(_));o.outrogroups.size===0&&(o.outrogroups=null)}if(i!==null||c!==void 0){var h=[];if(c!==void 0)for(n of c)(n.f&P)===0&&h.push(n);for(;i!==null;)(i.f&P)===0&&i!==o.fallback&&h.push(i),i=i.next;var w=h.length;if(w>0){var M=(f&y)!==0&&e===0?d:null;if(t){for(l=0;l<w;l+=1)h[l].nodes?.a?.measure();for(l=0;l<w;l+=1)h[l].nodes?.a?.fix()}Se(o,h,M)}}t&&_e(()=>{if(S!==void 0)for(n of S)n.nodes?.a?.apply()})}function me(o,s,d,f,a,t,e,r){var i=(e&se)!==0?(e&ce)===0?ue(d,!1,!1):q(d):null,c=(e&fe)!==0?q(a):null;return{v:i,i:c,e:H(()=>(t(s,i??d,c??a,r),()=>{o.delete(f)}))}}function R(o,s,d){if(o.nodes)for(var f=o.nodes.start,a=o.nodes.end,t=s&&(s.f&m)===0?s.nodes.start:d;f!==null;){var e=le(f);if(t.before(f),f===a)return;f=e}}function k(o,s,d){s===null?o.effect.first=d:s.next=d,d===null?o.effect.last=s:d.prev=s}const J="projects";function ke(){let o=[];if(typeof window<"u"){const a=localStorage.getItem(J);if(a)try{o=JSON.parse(a)}catch(t){console.error("Failed to parse projects from localStorage:",t)}}const{subscribe:s,set:d,update:f}=he(o);return s(a=>{typeof window<"u"&&localStorage.setItem(J,JSON.stringify(a))}),{subscribe:s,set:d,update:f,addProject(a){f(t=>[...t,a])},deleteProject(a){f(t=>t.filter(e=>e.uuid!==a))},updateProject(a,t){f(e=>e.map(r=>r.uuid===a?{...r,name:t}:r))},updateProjectImage(a,t){f(e=>e.map(r=>r.uuid===a?{...r,image:t}:r))},updateProjectCrop(a,t){f(e=>e.map(r=>r.uuid===a?{...r,cropPoints:t}:r))},updateProjectGrid(a,t,e,r,i){f(c=>c.map(u=>u.uuid===a?{...u,rows:t,cols:e,gridColor:r??u.gridColor,gridThickness:i??u.gridThickness}:u))},updateProjectColors(a,t){f(e=>e.map(r=>r.uuid===a?{...r,colors:[...t]}:r))},updateProjectWorkingState(a,t){f(e=>e.map(r=>r.uuid===a?{...r,workingState:{isActive:!1,currentRow:0,currentCol:0,startFromBottom:!0,startStitch:"K",knitDirection:"RTL",perlDirection:"LTR",highlightColor:"rgba(34, 197, 94, 0.4)",startCol:0,correctedLetters:{},undoStack:[],redoStack:[],correctionMode:!1,selectedLetter:void 0,...r.workingState,...t}}:r))},paintCell(a,t,e){f(r=>r.map(i=>{if(i.uuid!==a)return i;const c={...i.correctedLetters||{}},u=i.__undoStack||[];return i.__redoStack,u.push({...c}),c[t]=e,{...i,correctedLetters:c,__undoStack:u,__redoStack:[]}}))},undoCorrection(a){f(t=>t.map(e=>{if(e.uuid!==a)return e;const r=e.__undoStack||[];if(r.length===0)return e;const i=r[r.length-1],c=e.__redoStack||[];return c.push(e.correctedLetters||{}),{...e,correctedLetters:i,__undoStack:r.slice(0,-1),__redoStack:c}}))},redoCorrection(a){f(t=>t.map(e=>{if(e.uuid!==a)return e;const r=e.__redoStack||[];if(r.length===0)return e;const i=r[r.length-1],c=e.__undoStack||[];return c.push(e.correctedLetters||{}),{...e,correctedLetters:i,__undoStack:c,__redoStack:r.slice(0,-1)}}))},clearCorrections(a){f(t=>t.map(e=>e.uuid!==a?e:{...e,correctedLetters:{},__undoStack:[],__redoStack:[]}))},toggleCorrectionMode(a){f(t=>t.map(e=>e.uuid===a?{...e,correctionModeActive:!e.correctionModeActive}:e))},setCorrectionLetter(a,t){f(e=>e.map(r=>r.uuid===a?{...r,selectedLetter:t}:r))},setBrushSize(a,t){f(e=>e.map(r=>r.uuid===a?{...r,brushSize:Math.max(1,Math.min(5,t))}:r))},updateViewportState(a,t){f(e=>e.map(r=>r.uuid===a?{...r,viewportState:{zoomLevel:1,panX:0,panY:0,...r.viewportState||{},...t}}:r))}}}const Le=ke();export{Te as e,we as i,Le as p};
